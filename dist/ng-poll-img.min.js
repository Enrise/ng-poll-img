/**
 * @title ng-poll-img.js
 * @description An AngularJS directive which polls the server for an image and shows a fallback until it's available.
 * @author Rick Kuipers <rskuipers@enrise.com>
 * @version 1.0.0
 *
 * @example <poll-img source="http://example.com/2Fd1aZs.jpg" class="img-responsive" fallback="http://placehold.it/1216x400" on-success="success()"></poll-img>
 */
angular.module("ngPollImg",[]).directive("pollImg",["$http","$timeout",function(e,r){return{restrict:"E",replace:!0,template:'<img ng-src="{{ currentSource }}" ng-class="{\'ng-poll-img-loaded\': imageLoaded}" />',scope:{source:"@",fallback:"@",currentSource:"@",interval:"@",giveUpAfter:"@",onSuccess:"&?"},link:function(c){c.interval=c.interval||3e3,c.giveUpAfter=c.giveUpAfter||0,c.imageLoaded=!1;var t=0,n=function(){t++,e.get(c.source).success(function(){c.currentSource=c.source,c.imageLoaded=!0,c.onSuccess&&c.onSuccess()}).error(function(){c.currentSource=c.fallback,(0==c.giveUpAfter||t<c.giveUpAfter)&&r(n,c.interval)})};n()}}}]);